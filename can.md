| https://aijishu.com/a/1060000000363516#item-6 | 通俗易懂的CAN网络解读            |
| --------------------------------------------- | -------------------------------- |
| https://aijishu.com/a/1060000000376098        | 汽车CAN-FD总线通信应用研究       |
| https://aijishu.com/a/1060000000385930        | CAN总线错误帧及排查方法简介      |
| https://aijishu.com/a/1060000000410102        | 一文了解CAN bootloader的实现过程 |
| https://aijishu.com/a/1060000000424521        | 技术科普：控制器局域网-CAN       |
|                                               |                                  |



# CAN网络解读

## 定义
CAN,全称为“Controller Area Network”,CAN总线是控制器局域网总网，由德国博世公司研发出来的IOS国际标准化串行通信协议总线，是一种分布式实时控制的串行网络，用于在不同的ECU下传输数据,是国际应用最广的现场总线之一。

## can总线标准
CAN总线标准规定数据链路层和物理层，应用层需要用户定义，不同场景使用的不同的应用层标准，例如物理层和数据链路层使用ISO 11898 协议。

## can数据链路层
遵循IOS\OSIwnagl标准模型，can规定了数据链路层和物理层，数据链路层又分逻辑链路控制子层LLC和媒介访问控制子层MAC，不同的can标准仅物理层不同。

![image-20240229165255440](C:\notreadpaper\assets\image-20240229165255440.png)

## CAN电压 差分信号
CAN总线上通过CAN_H和CAN_L两条线的电位差来表示can信号，can总线上两种电位差分别为显性电平逻辑0和隐性电平逻辑1，显性电平优先级高于隐性电平，can控制器将cpu传来的信号转为逻辑电平，can发射器将接收到的逻辑电平转化成差分电发送到can总线上。

![image-20240229165409527](C:\notreadpaper\assets\image-20240229165409527.png)

## can的优点
1. 传输速度：传输最高速度可达1mbps，最远1000米，无损位仲裁机制，多主结构 

2. 低成本：ECUs通过单个CAN接口通信，布线成本低 

3. 高集成：CAN总线系统允许在所有ECUs上进行集中诊断和配置 

4. 可靠性：该系统对子系统故障和电磁干扰有很强的鲁棒性，是汽车控制系统的理想选择 

5. 高效率：可以对信息ID进行优先排序，以便最高等级的的信息不被中断 

6. 灵活性：每个ECU包含一个用于can信号收发芯片，随意添加can节点


## can的特点
- 多主控制：总线空闲时ECU都可以发送信号，两个以上单位同时发送信号时以标识符（ID）决定优先级 。

- 系统柔软性：连接总线的单元没有“地址”信息

- 故障封闭功能：CAN可以判断出错误的类型是总线上暂时的数据错误，当总线上发生持续数据错误时，可将引起此故障的单元从总线上隔离出去。


## CAN通讯
CAN通讯是一种基于信号的通信，信号的发送一般是基于事件和周期的属性，CAN信号发送可以一对一，也可以一对多，采用广播形式，也就一条总线上一个节点发送的信号会被其他节点接收到，所以一条can总线上不允许多个ECU发送相同的CANID，避免总线冲突。

## CAN报文发送流程
**节点发送要检测到总线空闲状态（连续11位隐性） 。**
**只有总线空闲时节点才能发送报文 在发送过程中进行回读，判断发出的位和回读的位是否一致。**
**线与机制 通过ID进行制裁 显性位能够覆盖隐性位，报文ID值越小，优先等级越高。**
**报文同时发送时才启动仲裁机制**
**通过滤波器对接收的报文进行过滤 。**
**相关就接收，不相关就过滤。**

![image-20240229170038196](C:\notreadpaper\assets\image-20240229170038196.png)

## CAN数据帧格式
1. 数据帧：用于发送单元向接收单元传送数据的桢 

2. 遥控帧：用于接收单元向相同ID单元发送请求的桢 

3. 错误帧：用于当检测出错误时向其他单元通知错误的桢 

4. 过载帧：用于接收单元通知其尚未做好准备的桢 

5. 帧间隔：用于将数据桢和远程桢与前面桢隔开的桢


![image-20240229170240186](C:\notreadpaper\assets\image-20240229170240186.png)

解释每帧：https://aijishu.com/a/1060000000363516#item-6

## CAN网络负载率
CAN负载率概念CAN总线负载率是指在CAN总线上单位时间内实际传送的位数和可以传送的位数之比。
标准CAN负载率计算
帧起始（1bit）、仲裁域（12bit）、控制域（6bit）、数据域（8×8bit）、循环冗余码域（15bit）、应答域（2bit）、1（bit）分隔符和帧结尾（7bit），共108位，但实际发送一帧报文长度应该在111左右。
拓展帧负载率计算
帧起始（1bit）、仲裁域（29bit）、控制域（6bit）、数据域（8×8bit）、循环冗余码域（15bit）、应答域（2bit）和帧结尾（7bit），共124位，但实际发送一帧报文长度应该在128左右。